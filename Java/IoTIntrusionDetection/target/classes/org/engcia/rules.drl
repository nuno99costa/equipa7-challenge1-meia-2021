/*
 * Copyright 2015 Red Hat, Inc. and/or its affiliates.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/

package org.engcia;

import org.engcia.model.Evidence;
import org.engcia.model.Hypothesis;
import org.engcia.model.Conclusion;
import org.engcia.model.Fact;

import function org.engcia.view.UI.answer;

query "Conclusions"
	$conclusion : Conclusion()
end

rule "hns1"
	when
		eval(answer(Evidence.ORIG_PKTS, ">", 11.5 ))
	then
		Conclusion c = new Conclusion(Conclusion.HIDE_AND_SEEK, 100.00);
        insert(c);
end

rule "hns2"
	when
		eval(answer(Evidence.ORIG_PKTS, "<=", 11.5 ))
	then
		Hypothesis h = new Hypothesis("orig_pkts_le11");
		insert(h);
end

rule "hns3"
	when
		Hypothesis( description == "orig_pkts_le11")
		eval(answer(Evidence.RESP_PKTS, ">", 2))
	then
		Conclusion c = new Conclusion(Conclusion.HIDE_AND_SEEK, 15.43);
		insert(c);
end

rule "hns4"
	when
		Hypothesis( description == "orig_pkts_le11")
		eval(answer(Evidence.RESP_PKTS, "<=", 2))
	then
		Hypothesis h = new Hypothesis("orig_pkts_le11_resp_pkts_le2");
		insert(h);
end

rule "hns5"
	when
		Hypothesis( description == "orig_pkts_le11_resp_pkts_le2")
		eval(answer(Evidence.CONN_STATE, "S2"))
	then
		Conclusion c = new Conclusion(Conclusion.HIDE_AND_SEEK, 13.69);
		insert(c);
end

rule "hns6"
	when
		Hypothesis( description == "orig_pkts_le11_resp_pkts_le2")
        not(eval(answer(Evidence.CONN_STATE, "S2")))
	then
		Hypothesis h = new Hypothesis("orig_pkts_le11_resp_pkts_le2_conn_state_niS2");
		insert(h);
end

rule "hns7"
	when
		Hypothesis( description == "orig_pkts_le11_resp_pkts_le2_conn_state_niS2")
		eval(answer(Evidence.HISTORY, ">", 38.5))
	then
		Conclusion c = new Conclusion(Conclusion.HIDE_AND_SEEK, 13.69);
		insert(c);
end

rule "hns8"
	when
    		Hypothesis( description == "orig_pkts_le11_resp_pkts_le2_conn_state_niS2")
    		eval(answer(Evidence.HISTORY, "<=", 38.5))
    	then
    		Conclusion c = new Conclusion(Conclusion.HIDE_AND_SEEK, 0.00);
    		insert(c);
end

query "evidence"(String ev, String v)
	e : Evidence( evidence == ev, value == v )
end

